<!DOCTYPE html>
<html lang="pr-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Página de Lançamentos</title>
</head>

<body>
    <div class="container">
        <header>
            <div id="logoFADERGS"></div>

            <div id="headerTitle">
                <p>Gestão e Qualidade de Software - 2024/1</p><br>
                <p>Projeto A3</p>
            </div>

            <div id="logoANIMA"></div>
        </header>

        <main>
            <div id="navBar">
                |
                <a href="./LoginPage.HTML">Login</a> |
                <a href="./UserCRUD.html">Usuários</a> |
                <a href="./CreditorCRUD.html">Credores</a> |
                <a href="./AddressCRUD.html">Bases</a> |
                <a href="./ExpenseCRUD.html">Despesas</a> |
                <a href="./EntryCRUD.html">Lançamentos</a> |
            </div>

            <div id="testContent">
                <div id="TCTitle">Lançamentos</div>

                <div id="TCMainContent">
                    
                    <form id="lancamentoForm">
                        <label for="idBase">ID da Base:</label>
                        <input type="number" id="idBase" name="idBase" required><br>
                    
                        <label for="idUsuario">ID do Usuário:</label>
                        <input type="number" id="idUsuario" name="idUsuario" required><br>
                    
                        <label for="idDespesa">ID da Despesa:</label>
                        <input type="number" id="idDespesa" name="idDespesa" required><br>
                    
                        <label for="competenciaDespesa">Competência da Despesa:</label>
                        <input type="text" id="competenciaDespesa" name="competenciaDespesa" required><br>
                    
                        <label for="dataVencimento">Data de Vencimento:</label>
                        <input type="date" id="dataVencimento" name="dataVencimento" required><br>
                    
                        <label for="valorOriginal">Valor Original:</label>
                        <input type="number" step="0.01" id="valorOriginal" name="valorOriginal" required><br>
                    
                        <label for="valorMulta">Valor da Multa:</label>
                        <input type="number" step="0.01" id="valorMulta" name="valorMulta"><br>
                    
                        <label for="valorCorrecao">Valor da Correção:</label>
                        <input type="number" step="0.01" id="valorCorrecao" name="valorCorrecao"><br>
                    
                        <label for="ativo">Ativo:</label>
                        <select id="ativo" name="ativo">
                            <option value="S">Sim</option>
                            <option value="N">Não</option>
                        </select><br>
                    
                        <label for="observacao">Observação:</label>
                        <textarea id="observacao" name="observacao"></textarea><br>
                    
                        <button type="button" onclick="addLancamento()">Adicionar Lançamento</button>
                        <button type="button" onclick="updateLancamento()">Atualizar Lançamento</button>
                      </form>
                    
                      <h2>Lista de Lançamentos</h2>
                      <div id="tableContainer">
                          <table id="lancamentoTable">
                            <thead>
                              <tr>
                                <th>ID da Base</th>
                                <th>ID do Usuário</th>
                                <th>ID da Despesa</th>
                                <th>Competência da Despesa</th>
                                <th>Data de Vencimento</th>
                                <th>Valor Original</th>
                                <th>Valor da Multa</th>
                                <th>Valor da Correção</th>
                                <th>Ativo</th>
                                <th>Observação</th>
                                <th>Ações</th>
                              </tr>
                            </thead>
                            <tbody>
                              
                            </tbody>
                          </table>
                      </div>
                    
                      <script>
                          let selectedRow = null;

                          function addLancamento() {
                              const idBase = document.getElementById('idBase').value;
                              const idUsuario = document.getElementById('idUsuario').value;
                              const idDespesa = document.getElementById('idDespesa').value;
                              const competenciaDespesa = document.getElementById('competenciaDespesa').value;
                              const dataVencimento = document.getElementById('dataVencimento').value;
                              const valorOriginal = document.getElementById('valorOriginal').value;
                              const valorMulta = document.getElementById('valorMulta').value;
                              const valorCorrecao = document.getElementById('valorCorrecao').value;
                              const ativo = document.getElementById('ativo').value;
                              const observacao = document.getElementById('observacao').value;                   

                              if (selectedRow == null) {
                                  const table = document.getElementById('lancamentoTable').getElementsByTagName('tbody')[0];
                                  const newRow = table.insertRow();                   
        
                                  newRow.insertCell(0).innerHTML = idBase;
                                  newRow.insertCell(1).innerHTML = idUsuario;
                                  newRow.insertCell(2).innerHTML = idDespesa;
                                  newRow.insertCell(3).innerHTML = competenciaDespesa;
                                  newRow.insertCell(4).innerHTML = dataVencimento;
                                  newRow.insertCell(5).innerHTML = valorOriginal;
                                  newRow.insertCell(6).innerHTML = valorMulta;
                                  newRow.insertCell(7).innerHTML = valorCorrecao;
                                  newRow.insertCell(8).innerHTML = ativo;
                                  newRow.insertCell(9).innerHTML = observacao
                                  newRow.insertCell(10).innerHTML = `<button onclick="editLancamento(this)">Editar</button>
                                  <button onclick="deleteLancamento(this)">Excluir</button>`;
    
                                  document.getElementById('lancamentoForm').reset();

                              } else {
                                  updateLancamento();
                            }
                          }

                        function editLancamento(td) {
                            selectedRow = td.parentElement.parentElement;
                            document.getElementById('idBase').value = selectedRow.cells[0].innerHTML;
                            document.getElementById('idUsuario').value = selectedRow.cells[1].innerHTML;
                            document.getElementById('idDespesa').value = selectedRow.cells[2].innerHTML;
                            document.getElementById('competenciaDespesa').value = selectedRow.cells[3].innerHTML;
                            document.getElementById('dataVencimento').value = selectedRow.cells[4].innerHTML;
                            document.getElementById('valorOriginal').value = selectedRow.cells[5].innerHTML;
                            document.getElementById('valorMulta').value = selectedRow.cells[6].innerHTML;
                            document.getElementById('valorCorrecao').value = selectedRow.cells[7].innerHTML;
                            document.getElementById('ativo').value = selectedRow.cells[8].innerHTML;
                            document.getElementById('observacao').value = selectedRow.cells[9].innerHTML;
                        }

                        function updateLancamento() {
                            if (selectedRow != null) {
                              selectedRow.cells[0].innerHTML = document.getElementById('idBase').value;
                              selectedRow.cells[1].innerHTML = document.getElementById('idUsuario').value;
                              selectedRow.cells[2].innerHTML = document.getElementById('idDespesa').value;
                              selectedRow.cells[3].innerHTML = document.getElementById('competenciaDespesa').value;
                              selectedRow.cells[4].innerHTML = document.getElementById('dataVencimento').value;
                              selectedRow.cells[5].innerHTML = document.getElementById('valorOriginal').value;
                              selectedRow.cells[6].innerHTML = document.getElementById('valorMulta').value;
                              selectedRow.cells[7].innerHTML = document.getElementById('valorCorrecao').value;
                              selectedRow.cells[8].innerHTML = document.getElementById('ativo').value;
                              selectedRow.cells[9].innerHTML = document.getElementById('observacao').value;

                              selectedRow = null;
                              document.getElementById('lancamentoForm').reset();
                            }
                        }

                        function deleteLancamento(td) {
                          if (confirm('Tem certeza que deseja excluir este lançamento?')) {
                              const row = td.parentElement.parentElement;
                              document.getElementById('lancamentoTable').deleteRow(row.rowIndex);
                              document.getElementById('lancamentoForm').reset();
                            }
                        }

                      </script>
                   

                </div>

            </div>

        </main>

        <footer>

        </footer>
    </div>
</body>
</html>